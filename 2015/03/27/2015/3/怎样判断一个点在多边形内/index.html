<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 怎样判断一个点在多边形内 · Hexo</title><meta name="description" content="怎样判断一个点在多边形内 - solos"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="http://fonts.useso.com/css?family=Source+Sans+Pro:400,600" type="text/css"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/sunchongsheng" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/pinggod" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">怎样判断一个点在多边形内</h1><div class="post-info">Mar 27, 2015</div><div class="post-content"><p>#缘起</p>
<p>最近头脑发热，突然想研究下怎么判断一个坐标点是否在一个多边形内，这个问题解决之后就可以根据一个坐标点计算出这个点所在的行政区划。</p>
<p>#算法<br>从网上找了一下，发现了一个很巧妙的算法，算法如下：</p>
<pre><code>* 把整个平面分为两个部分（x&gt;0&amp;&amp;y==0||y&gt;0部分和x&lt;0&amp;&amp;y==0||y&lt;0部分）
* 顺序扫描多边形每一个顶点，当某个顶点和前一个顶点处于不同部分时，判断一下从前一个点到该点的方向相对于原点是顺时针还是逆时针（用叉积判断），如果是顺时针r++，否则r--（r初始为0）
* 如果结果r==2||r==-2，则原点在该多边形内部，否则不是。
</code></pre><p>#python实现</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">    <span class="comment">#!/usr/bin/env python</span></div><div class="line">    <span class="comment"># -*- coding: utf-8 -*-</span></div><div class="line"></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">is_point_in</span><span class="params">(x, y, points)</span>:</span></div><div class="line">        count = <span class="number">0</span></div><div class="line">        x1, y1 = points[<span class="number">0</span>]</div><div class="line">        x1_part = (y1 &gt; y) <span class="keyword">or</span> ((x1 - x &gt; <span class="number">0</span>) <span class="keyword">and</span> (y1 == y)) <span class="comment"># x1在哪一部分中</span></div><div class="line">        x2, y2 = <span class="string">''</span>, <span class="string">''</span>  <span class="comment"># points[1]</span></div><div class="line">        points.append((x1, y1))</div><div class="line">        <span class="keyword">for</span> point <span class="keyword">in</span> points[<span class="number">1</span>:]:</div><div class="line">            x2, y2 = point</div><div class="line">            x2_part = (y2 &gt; y) <span class="keyword">or</span> ((x2 &gt; x) <span class="keyword">and</span> (y2 == y)) <span class="comment"># x2在哪一部分中</span></div><div class="line">            <span class="keyword">if</span> x2_part == x1_part:</div><div class="line">                x1, y1 = x2, y2</div><div class="line">                <span class="keyword">continue</span></div><div class="line">            mul = (x1 - x)*(y2 - y) - (x2 - x)*(y1 - y)</div><div class="line">            <span class="keyword">if</span> mul &gt; <span class="number">0</span>:  <span class="comment"># 叉积大于0 逆时针</span></div><div class="line">                count += <span class="number">1</span></div><div class="line">            <span class="keyword">elif</span> mul &lt; <span class="number">0</span>:</div><div class="line">                count -= <span class="number">1</span></div><div class="line">            x1, y1 = x2, y2</div><div class="line">            x1_part = x2_part</div><div class="line">        <span class="keyword">if</span> count == <span class="number">2</span> <span class="keyword">or</span> count == <span class="number">-2</span>:</div><div class="line">            <span class="keyword">return</span> <span class="keyword">True</span></div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            <span class="keyword">return</span> <span class="keyword">False</span></div><div class="line"></div><div class="line"></div><div class="line">    <span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line">        points = [[<span class="number">117.1510864068032</span>,<span class="number">40.0705150448258</span>],[<span class="number">117.2866776871509</span>,<span class="number">40.10934259697606</span>], ... ]</div><div class="line">        y = <span class="number">39.99</span></div><div class="line">        x = <span class="number">116.468006</span></div><div class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="number">10000</span>):</div><div class="line">            is_point_in(x + i * <span class="number">0.01</span>, y + i * <span class="number">0.01</span>, points)</div><div class="line"></div><div class="line"><span class="comment">##执行时间:</span></div><div class="line"></div><div class="line">``` bash</div><div class="line"></div><div class="line">    time python point.py</div><div class="line"></div><div class="line">    real    <span class="number">0</span>m8<span class="number">.746</span>s</div><div class="line">    user    <span class="number">0</span>m8<span class="number">.680</span>s</div><div class="line">    sys <span class="number">0</span>m0<span class="number">.034</span>s</div></pre></td></tr></table></figure>
<p>执行了10,000次，耗时8.746秒，太慢了有木有, 改成go试试</p>
<p>#golang实现</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">package</span> main</div><div class="line"></div><div class="line"><span class="keyword">import</span> (</div><div class="line">    <span class="comment">//"fmt"</span></div><div class="line">)</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">is_point_in</span><span class="params">(x <span class="keyword">float64</span>, y <span class="keyword">float64</span>, points [][]<span class="keyword">float64</span>)</span> <span class="title">bool</span></span> &#123;</div><div class="line">    count := <span class="number">0</span></div><div class="line">    x1, y1 := points[<span class="number">0</span>][<span class="number">0</span>], points[<span class="number">0</span>][<span class="number">1</span>]</div><div class="line">    x1_part := (y1 &gt; y) || ((x1 - x &gt; <span class="number">0</span>) &amp;&amp; (y1 == y))</div><div class="line">    <span class="keyword">var</span> a = []<span class="keyword">float64</span>&#123;x1, y1&#125;</div><div class="line">    p := <span class="built_in">append</span>(points, a)</div><div class="line">    <span class="keyword">for</span> i := <span class="keyword">range</span> p &#123;</div><div class="line">        <span class="keyword">if</span> (i == <span class="number">0</span>) &#123;</div><div class="line">            <span class="keyword">continue</span></div><div class="line">        &#125;</div><div class="line">        point := p[i]</div><div class="line">        x2, y2 := point[<span class="number">0</span>], point[<span class="number">1</span>]</div><div class="line">        x2_part := (y2 &gt; y) || ((x2 &gt; x) &amp;&amp; (y2 == y))</div><div class="line">        <span class="keyword">if</span> (x2_part == x1_part)&#123;</div><div class="line">            x1, y1 = x2, y2</div><div class="line">            <span class="keyword">continue</span></div><div class="line">        &#125;</div><div class="line">        mul := (x1 - x)*(y2 - y) - (x2 - x)*(y1 - y)</div><div class="line">        <span class="keyword">if</span> mul &gt; <span class="number">0</span> &#123;</div><div class="line">            count += <span class="number">1</span></div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">if</span>( mul &lt; <span class="number">0</span>) &#123;</div><div class="line">                count -= <span class="number">1</span></div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        x1, y1 = x2, y2</div><div class="line">        x1_part = x2_part</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (count == <span class="number">2</span> || count == <span class="number">-2</span>)&#123;</div><div class="line">        <span class="keyword">return</span> <span class="literal">true</span></div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">return</span> <span class="literal">false</span></div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">    points := [][]<span class="keyword">float64</span>&#123;&#123;<span class="number">117.1510864068032</span>,<span class="number">40.0705150448258</span>&#125;,&#123;<span class="number">117.2866776871509</span>,<span class="number">40.10934259697606</span>&#125;, ... ,&#125;</div><div class="line">    y := <span class="number">39.99</span></div><div class="line">    x := <span class="number">116.468006</span></div><div class="line">    <span class="keyword">for</span> i:=<span class="number">1</span>; i &lt; <span class="number">10000</span>; i++ &#123;</div><div class="line">        _ = is_point_in(x + <span class="keyword">float64</span>(i)*<span class="number">0.01</span>, y + <span class="keyword">float64</span>(i) * <span class="number">0.01</span>, points)</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>##执行时间:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">go build point.go</div><div class="line">time ./point</div><div class="line"></div><div class="line">real    0m0.038s</div><div class="line">user    0m0.035s</div><div class="line">sys 0m0.005s</div></pre></td></tr></table></figure>
<p>执行了10,000次，耗时0.038秒</p>
<p>#总结</p>
<p>go版本比python版本快200多倍，代码行数python 35行, go 51行（有些括号独占一行），是时候换go了…..</p>
<p>#参考资料:</p>
<pre><code>- [判断点在多边形内](http://bbs.sjtu.edu.cn/bbstcon,board,C,reid,1105270922.html)
</code></pre></div></article></div></section><footer><div class="paginator"><a href="/2015/05/06/2015/5/Mac终端使用shadowsocks代理/" class="prev">上一篇</a><a href="/2015/02/11/2015/2/tornado静态文件增加header/" class="next">下一篇</a></div><div class="copyright"><p>© 2015 - 2016 <a href="http://solos.so">solos</a>, unless otherwise noted.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></body></html>